import instaloader
import os
from time import sleep
from random import uniform, choice, randint
import schedule
import time
from instagrapi import Client

# –ß–∞—Å—Ç—å 1: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–æ—Ç–æ –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è —Ü–µ–ª–µ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

def get_last_downloaded_index(file_path):
    if os.path.exists(file_path):
        with open(file_path, 'r') as file:
            return int(file.read().strip())
    return -1

def set_last_downloaded_index(file_path, index):
    with open(file_path, 'w') as file:
        file.write(str(index))

def download_photo(target_username, output_dir, index_file):
    L = instaloader.Instaloader(download_pictures=True, download_videos=False,
                                download_video_thumbnails=False, download_geotags=False,
                                download_comments=False, save_metadata=False,
                                post_metadata_txt_pattern="")

    # –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    if not os.path.exists(output_dir):
        os.makedirs(output_dir)

    # –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞–ø–∫—É –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    L.dirname_pattern = output_dir

    # –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
    profile = instaloader.Profile.from_username(L.context, target_username)
    posts = list(profile.get_posts())

    last_index = get_last_downloaded_index(index_file)
    next_index = last_index + 1

    if next_index < len(posts):
        post = posts[next_index]
        L.download_post(post, target=target_username)
        set_last_downloaded_index(index_file, next_index)
        return True
    else:
        print("No more posts to download.")
        return False

# –ß–∞—Å—Ç—å 2: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –≤ –≤–∞—à –ø—Ä–æ—Ñ–∏–ª—å –∏ —É–¥–∞–ª–µ–Ω–∏–µ –µ–≥–æ

def upload_photo(cl, folder_path):
    praises = [
        "–ù–∞—à–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å –≤–µ–ª–∏–∫–æ–ª–µ–ø–Ω—ã–º! üåü",
        "–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –∫–∞–∫–æ–µ –∏–∑—è—â–Ω–æ–µ –∏ —Å—Ç–∏–ª—å–Ω–æ–µ —É–∫—Ä–∞—à–µ–Ω–∏–µ! ‚ú®",
        "–ö–∞–∂–¥–∞—è –¥–µ—Ç–∞–ª—å –¥–µ–∫–æ—Ä–∞ –ø–æ–¥–æ–±—Ä–∞–Ω–∞ —Å –æ–≥—Ä–æ–º–Ω–æ–π –ª—é–±–æ–≤—å—é –∏ –≤–Ω–∏–º–∞–Ω–∏–µ–º –∫ –º–µ–ª–æ—á–∞–º. ‚ù§Ô∏è",
        "–≠—Ç–æ—Ç –¥–µ–∫–æ—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç –≤–æ–ª—à–µ–±—Å—Ç–≤–∞ –∏ —ç–ª–µ–≥–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –ª—é–±–æ–º—É –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤—É! ü™Ñ",
        "–£ –Ω–∞—Å –ø–æ–ª—É—á–∏–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –Ω–∞—Å—Ç–æ—è—â–µ–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∏—Å–∫—É—Å—Å—Ç–≤–∞! üé®",
        "–≠—Ç–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Ç–æ—á–Ω–æ –ø—Ä–∏–≤–ª–µ—á–µ—Ç –≤—Å–µ–æ–±—â–µ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –∏ –≤–æ—Å—Ö–∏—â–µ–Ω–∏–µ. üëÄ",
        "–ö–∞–∫–æ–µ –∏–∑—ã—Å–∫–∞–Ω–Ω–æ–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤ –∏ —Ç–µ–∫—Å—Ç—É—Ä! üåà",
        "–ö–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–µ–∫–æ—Ä–∞ –æ—Ç—Ä–∞–∂–∞–µ—Ç –Ω–∞—à—É —Å—Ç—Ä–∞—Å—Ç—å –∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å. üåü",
        "–ù–∞—à–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ—Å—Ç—å —ç—Ç–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞. üè†",
        "–≠—Ç–æ –ø—Ä–æ—Å—Ç–æ —Ñ–∞–Ω—Ç–∞—Å—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ! –°–ª–æ–∂–Ω–æ –æ—Ç–≤–µ—Å—Ç–∏ –≤–∑–≥–ª—è–¥. üòç",
        "–ö–∞–∂–¥–∞—è –¥–µ—Ç–∞–ª—å –∑–¥–µ—Å—å —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Ä–∞–¥–æ–≤–∞—Ç—å –≥–ª–∞–∑. üòä",
        "–≠—Ç–æ –Ω–∞—Å—Ç–æ—è—â–∏–π –ø—Ä–∞–∑–¥–Ω–∏–∫ –¥–ª—è –ª—é–±–∏—Ç–µ–ª–µ–π —Å—Ç–∏–ª—å–Ω–æ–≥–æ –¥–µ–∫–æ—Ä–∞! üéâ",
        "–ù–∞—à–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø—Ä–∏–¥–∞–µ—Ç –æ—Å–æ–±—É—é –∞—Ç–º–æ—Å—Ñ–µ—Ä—É –∏ —É—é—Ç. üè°",
        "–≠—Ç–æ—Ç –¥–µ–∫–æ—Ä —Å–æ–∑–¥–∞–Ω –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –≤–¥–æ—Ö–Ω–æ–≤–ª—è—Ç—å –∏ —Ä–∞–¥–æ–≤–∞—Ç—å. üíñ",
        "–£ –Ω–∞—Å –ø–æ–ª—É—á–∏–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –≥–∞—Ä–º–æ–Ω–∏—á–Ω–æ–µ –∏ —É—Ç–æ–Ω—á–µ–Ω–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ! üå∏",
        "–ö–∞–∂–¥–∞—è –¥–µ—Ç–∞–ª—å –≥–æ–≤–æ—Ä–∏—Ç –æ –≤—ã—Å–æ–∫–æ–º —É—Ä–æ–≤–Ω–µ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞ –∏ –≤–∫—É—Å–∞. üíé",
        "–¢–∞–∫–æ–µ –∫—Ä–∞—Å–∏–≤–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ –Ω–µ –º–æ–∂–µ—Ç –Ω–µ –Ω—Ä–∞–≤–∏—Ç—å—Å—è! üòç",
        "–≠—Ç–æ—Ç –¥–µ–∫–æ—Ä –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –ª—é–±–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –≤ —Å–∫–∞–∑–∫—É. üè∞",
        "–ù–∞—à–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ ‚Äì —ç—Ç–æ –≤–æ–ø–ª–æ—â–µ–Ω–∏–µ –∫—Ä–∞—Å–æ—Ç—ã –∏ —ç–ª–µ–≥–∞–Ω—Ç–Ω–æ—Å—Ç–∏. üåπ",
        "–ú—ã –≥–æ—Ä–¥–∏–º—Å—è —Ç–µ–º, —á—Ç–æ —Å–æ–∑–¥–∞–ª–∏ —Ç–∞–∫–æ–π –ø–æ—Ç—Ä—è—Å–∞—é—â–∏–π –¥–µ–∫–æ—Ä! üéâ",
        "–ë—ñ–∑–¥—ñ“£ –¥–∏–∑–∞–π–Ω –∫–µ—Ä–µ–º–µ—Ç –±–æ–ª–¥—ã! üòç",
        "–ú—ã–Ω–∞—É “õ–∞–Ω–¥–∞–π ”ô–¥–µ–º—ñ –∂”ô–Ω–µ —Å—Ç–∏–ª—å–¥—ñ –±–µ–∑–µ–Ω–¥—ñ—Ä—É! ‚ú®",
        "”ò—Ä–±—ñ—Ä –¥–µ—Ç–∞–ª—å–≥–µ “Ø–ª–∫–µ–Ω –º–∞—Ö–∞–±–±–∞—Ç –ø–µ–Ω “±“õ—ã–ø—Ç—ã–ª—ã“õ–ø–µ–Ω –Ω–∞–∑–∞—Ä –∞—É–¥–∞—Ä—ã–ª“ì–∞–Ω. ‚ù§Ô∏è",
        "–ë“±–ª –¥–µ–∫–æ—Ä –∫–µ–∑-–∫–µ–ª–≥–µ–Ω –∫–µ“£—ñ—Å—Ç—ñ–∫–∫–µ —Å–∏“õ—ã—Ä –º–µ–Ω ”ô—Å–µ–º–¥—ñ–∫ “õ–æ—Å–∞–¥—ã! ‚ú®",
        "–ë—ñ–∑ –Ω–∞“ì—ã–∑ ”©–Ω–µ—Ä —Ç—É—ã–Ω–¥—ã—Å—ã–Ω –∂–∞—Å–∞–¥—ã“õ! üé®",
        "–ë“±–ª –±–µ–∑–µ–Ω–¥—ñ—Ä—É –±–∞—Ä–ª—ã“ì—ã–Ω ”©–∑—ñ–Ω–µ “õ–∞—Ä–∞—Ç–∞—Ç—ã–Ω—ã —Å”©–∑—Å—ñ–∑. üëÄ",
        "“ö–∞–Ω–¥–∞–π –Ω”ô–∑—ñ–∫ —Ç“Ø—Å—Ç–µ—Ä –º–µ–Ω —Ç–µ–∫—Å—Ç—É—Ä–∞–ª–∞—Ä–¥—ã“£ “Ø–π–ª–µ—Å—ñ–º—ñ! üåà",
        "”ò—Ä–±—ñ—Ä –¥–µ–∫–æ—Ä —ç–ª–µ–º–µ–Ω—Ç—ñ –±—ñ–∑–¥—ñ“£ “õ“±–º–∞—Ä–ª—ã“ì—ã–º—ã–∑ –±–µ–Ω —à—ã“ì–∞—Ä–º–∞—à—ã–ª—ã“ì—ã–º—ã–∑–¥—ã –∫”©—Ä—Å–µ—Ç–µ–¥—ñ. üåü",
        "–ë—ñ–∑–¥—ñ“£ –±–µ–∑–µ–Ω–¥—ñ—Ä—É –æ—Å—ã –∫–µ“£—ñ—Å—Ç—ñ–∫—Ç—ñ“£ –±—ñ—Ä–µ–≥–µ–π–ª—ñ–≥—ñ –º–µ–Ω –¥–∞—Ä–∞–ª—ã“ì—ã–Ω –∫”©—Ä—Å–µ—Ç–µ–¥—ñ. üåü",
        "–ë“±–ª —Ç–µ–∫ “õ–∏—è–ª “ì–∞–∂–∞–π—ã–ø –±–µ–∑–µ–Ω–¥—ñ—Ä—É! –ö”©–∑–¥—ñ –∞–ª–∞ –∞–ª–º–∞–π—Å—ã“£. üò≤",
        "–ú“±–Ω–¥–∞“ì—ã ”ô—Ä–±—ñ—Ä –¥–µ—Ç–∞–ª—å –∫”©–∑–¥—ñ “õ—É–∞–Ω—Ç–∞–¥—ã. üòä",
        "–ë“±–ª –Ω–∞“ì—ã–∑ —Å—Ç–∏–ª—å–¥—ñ –¥–µ–∫–æ—Ä–¥—ã —Å“Ø–π–µ—Ç—ñ–Ω–¥–µ—Ä–≥–µ –∞—Ä–Ω–∞–ª“ì–∞–Ω –º–µ—Ä–µ–∫–µ! üéâ",
        "–ë—ñ–∑–¥—ñ“£ –±–µ–∑–µ–Ω–¥—ñ—Ä—É –µ—Ä–µ–∫—à–µ –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞ –º–µ–Ω –∂–∞–π–ª—ã–ª—ã“õ –±–µ—Ä–µ–¥—ñ. üè°",
        "–ë“±–ª –¥–µ–∫–æ—Ä —à–∞–±—ã—Ç—Ç–∞–Ω–¥—ã—Ä—É –∂”ô–Ω–µ “õ—É–∞–Ω—ã—à —Å—ã–π–ª–∞—É “Ø—à—ñ–Ω –∂–∞—Å–∞–ª“ì–∞–Ω. üíñ",
        "–ë—ñ–∑ “Ø–π–ª–µ—Å—ñ–º–¥—ñ –∂”ô–Ω–µ –Ω”ô–∑—ñ–∫ –±–µ–∑–µ–Ω–¥—ñ—Ä—É –∂–∞—Å–∞–¥—ã“õ! üå∏",
        "”ò—Ä–±—ñ—Ä –¥–µ—Ç–∞–ª—å –∂–æ“ì–∞—Ä—ã –¥–µ“£–≥–µ–π–¥–µ–≥—ñ —à–µ–±–µ—Ä–ª—ñ–∫ –ø–µ–Ω —Ç–∞–ª“ì–∞–º–¥—ã –∫”©—Ä—Å–µ—Ç–µ–¥—ñ. üíé",
        "–ú“±–Ω–¥–∞–π ”ô–¥–µ–º—ñ –±–µ–∑–µ–Ω–¥—ñ—Ä—É —Ç–µ–∫ “±–Ω–∞–º–∞—É—ã –º“Ø–º–∫—ñ–Ω –µ–º–µ—Å! üòç",
        "–ë“±–ª –¥–µ–∫–æ—Ä –∫–µ–∑ –∫–µ–ª–≥–µ–Ω –∫–µ“£—ñ—Å—Ç—ñ–∫—Ç—ñ –µ—Ä—Ç–µ–≥—ñ–≥–µ –∞–π–Ω–∞–ª–¥—ã—Ä–∞–¥—ã. üè∞",
        "–ë—ñ–∑–¥—ñ“£ –±–µ–∑–µ–Ω–¥—ñ—Ä—É ‚Äì –±“±–ª —Å“±–ª—É–ª—ã“õ –ø–µ–Ω ”ô—Å–µ–º–¥—ñ–∫—Ç—ñ“£ –±–µ–π–Ω–µ—Å—ñ. üåπ",
        "–ë—ñ–∑ –æ—Å—ã–Ω–¥–∞–π —Ç–∞“£“ì–∞–∂–∞–π—ã–ø –¥–µ–∫–æ—Ä –∂–∞—Å–∞“ì–∞–Ω—ã–º—ã–∑“ì–∞ –º–∞“õ—Ç–∞–Ω–∞–º—ã–∑! üéâ"
    ]
    hashtags = "#–ê—Ç—ã—Ä–∞—É#Atyrau#–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–ê—Ç—ã—Ä–∞—É#–ë–∞–Ω–Ω–µ—Ä–ê—Ç—ã—Ä–∞—É#Atyraudecor#–ê—Ç—ã—Ä–∞—É–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ#–¢–æ–π–ê—Ç—ã—Ä–∞—É#–ê—Ç—ã—Ä–∞—É–¢–æ–π#"

    for filename in os.listdir(folder_path):
        if filename.endswith(('.jpg', '.jpeg', '.png')):
            photo_path = os.path.join(folder_path, filename)
            caption = f"{choice(praises)} {hashtags}"

            print(f"–ó–∞–≥—Ä—É–∂–∞–µ–º {photo_path} —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º: {caption}")
            try:
                cl.photo_upload(photo_path, caption)
                print(f"–£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ {photo_path}")

                # –£–¥–∞–ª—è–µ–º —Ñ–æ—Ç–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
                os.remove(photo_path)

                # –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ —Ñ–æ—Ç–æ –∏ –∑–∞–≤–µ—Ä—à–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é
                return
            except Exception as e:
                print(f"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å {photo_path}: {e}")

# –ß–∞—Å—Ç—å 3: –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏ –æ—Ç 12 –¥–æ 16 —á–∞—Å–æ–≤

def job():
    target_username = 'asruamina3'
    output_dir = 'images'
    index_file = 'last_downloaded_index.txt'

    # –°–∫–∞—á–∞—Ç—å —Ñ–æ—Ç–æ
    if not download_photo(target_username, output_dir, index_file):
        return  # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –µ—Å–ª–∏ –±–æ–ª—å—à–µ –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ Instagrapi –∏ –≤–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç
    username = "oformlenieatyrau06"
    password = "a9326191"
    cl = Client()
    cl.login(username, password)

    # –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–∫–∞—á–∞–Ω–Ω–æ–µ —Ñ–æ—Ç–æ
    upload_photo(cl, output_dir)

# –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
def schedule_job():
    job()
    next_run_in = randint(12, 16) * 3600  # –°–ª—É—á–∞–π–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç 12 –¥–æ 16 —á–∞—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    print(f"–°–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑: {next_run_in / 3600} —á–∞—Å–æ–≤")
    schedule.every(next_run_in).seconds.do(job)

# –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—É—Å–∫–æ–≤
schedule_job()

# –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å–∫—Ä–∏–ø—Ç–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
while True:
    schedule.run_pending()
    time.sleep(60)  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
